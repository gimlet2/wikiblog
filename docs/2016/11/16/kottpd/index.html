<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kottpd — HTTP Server in pure Kotlin | RestMonkeys tech blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="alternate" type="application/rss+xml" href="https://restmonkeys.com/rss.xml" title="RestMonkeys tech blog RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="https://restmonkeys.com/feed.atom" title="RestMonkeys tech blog Atom Feed">
    <link rel="alternate" type="application/json" href="https://restmonkeys.com/feed.json" title="RestMonkeys tech blog JSON Feed">
    <meta name="description" content="In today’s post I would like to talk about one of the projects I’m working on. I define it as light HTTP framework and it is made in pure Kotlin. Based on these two f ...">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.eb280cdd.css" as="style"><link rel="preload" href="/assets/js/app.35a895ae.js" as="script"><link rel="preload" href="/assets/js/6.5cfe2da4.js" as="script"><link rel="preload" href="/assets/js/3.7a9f361b.js" as="script"><link rel="preload" href="/assets/js/18.e20d596b.js" as="script"><link rel="prefetch" href="/assets/js/10.53b722e1.js"><link rel="prefetch" href="/assets/js/11.c7b7fac2.js"><link rel="prefetch" href="/assets/js/12.67e13ee5.js"><link rel="prefetch" href="/assets/js/13.fcc6c7b4.js"><link rel="prefetch" href="/assets/js/14.051375ab.js"><link rel="prefetch" href="/assets/js/15.c6d655ca.js"><link rel="prefetch" href="/assets/js/16.ac70bb37.js"><link rel="prefetch" href="/assets/js/17.a8f929b1.js"><link rel="prefetch" href="/assets/js/19.a1eb890d.js"><link rel="prefetch" href="/assets/js/20.85124f0d.js"><link rel="prefetch" href="/assets/js/21.02a5b55c.js"><link rel="prefetch" href="/assets/js/22.d3ea5f28.js"><link rel="prefetch" href="/assets/js/4.caa20593.js"><link rel="prefetch" href="/assets/js/5.1b59ba16.js"><link rel="prefetch" href="/assets/js/7.8de00af2.js"><link rel="prefetch" href="/assets/js/8.655651b7.js"><link rel="prefetch" href="/assets/js/9.87543dc0.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.83765843.js">
    <link rel="stylesheet" href="/assets/css/0.styles.eb280cdd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">RestMonkeys tech blog </a></div> <div class="header-right-wrap"><ul class="nav"></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <a href="/rss.xml" class="feed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">RestMonkeys tech blog </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"> <li class="mobile-nav-item"><a href="/rss.xml" class="feed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        Kottpd — HTTP Server in pure Kotlin
      </h1> <div class="post-meta"><!----> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2016-11-16T00:00:00.000Z">
      Wed Nov 16 2016
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-42ccfcd5><a href="/tag/kotlin" data-v-42ccfcd5><span data-v-42ccfcd5>kotlin</span></a></li><li class="post-tag" data-v-42ccfcd5><a href="/tag/https" data-v-42ccfcd5><span data-v-42ccfcd5>https</span></a></li><li class="post-tag" data-v-42ccfcd5><a href="/tag/java" data-v-42ccfcd5><span data-v-42ccfcd5>java</span></a></li><li class="post-tag" data-v-42ccfcd5><a href="/tag/rest-api" data-v-42ccfcd5><span data-v-42ccfcd5>rest-api</span></a></li><li class="post-tag" data-v-42ccfcd5><a href="/tag/programming" data-v-42ccfcd5><span data-v-42ccfcd5>programming</span></a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><p>In today’s post I would like to talk about one of the projects I’m working on. I define it as light <strong>HTTP framework</strong> and it is made in pure <a href="http://kotlinlang.org/" target="_blank" rel="noopener noreferrer"><strong>Kotlin</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Based on these two facts I’ve named it <a href="https://github.com/gimlet2/kottpd" target="_blank" rel="noopener noreferrer"><strong>kottpd</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>This project was born during long bus ride. There was no Internet and I decided to write something without external dependencies. What could be better then implementing well-known text-based protocol?!

Not all pieces were easy to find in the palaces of the mind but in couple of hours first version was ready to serve standard HTTP queries. The design of API was made with inspiration from <strong>Spark-Java</strong>. So, it looks quite similar.</p> <p>What we could find under the hood? First of all it is Cached ThreadsPool. It helps to allocate and reuse threads for each HTTP request. Then in infinite loop the server waits for incoming connections, reads it, tries to match against configured routes and passes to corresponding handler if found. Beside request handlers you could also specify <strong>Before</strong> and <strong>After</strong> filters to implement some sort of middleware(for example — login, transactions, etc.).</p> <h4 id="what-for-is-it-useful"><a href="#what-for-is-it-useful" class="header-anchor">#</a> What for is it useful?</h4> <p>Well, it could be used if you want to make a web application, or an <strong>REST API</strong> , or just to serve a static content(it supports that too!). But you want to do it in a lightweight way. And you like <strong>Kotlin</strong>! That it is a perfect choice for you. Have I mentioned it supports  <strong>SSL</strong>?</p> <p>To explain it better let me show you an example that could be easily found in the README file. But first of all you need to add it as a dependency to your project. The library is published into maven central repository, so you should not face any issues with it.</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code> <span class="token function">Server</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">{</span>
        <span class="token function">staticFiles</span><span class="token punctuation">(</span><span class="token string">&quot;/public&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> req<span class="token punctuation">,</span> res <span class="token operator">-&gt;</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/test&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> req<span class="token punctuation">,</span> res <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token function">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;Something bad happened&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/do/.*/smth&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> req<span class="token punctuation">,</span> res <span class="token operator">-&gt;</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;Hello world&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/data&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> req<span class="token punctuation">,</span> res <span class="token operator">-&gt;</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>content<span class="token punctuation">,</span> Status<span class="token punctuation">.</span>Created<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token function">before</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> req<span class="token punctuation">,</span> res <span class="token operator">-&gt;</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;before\n&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">{</span> req<span class="token punctuation">,</span> res <span class="token operator">-&gt;</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;ALL before\n&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token function">after</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> req<span class="token punctuation">,</span> res <span class="token operator">-&gt;</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;\nafter\n&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">{</span> req<span class="token punctuation">,</span> res <span class="token operator">-&gt;</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;ALL after\n&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token function">exception</span><span class="token punctuation">(</span>IllegalStateException<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> 
            <span class="token punctuation">{</span> req<span class="token punctuation">,</span> res <span class="token operator">-&gt;</span> <span class="token string">&quot;Illegal State&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>Here we create an instance of <em>Server</em> class, define path to the folder with static content we want our server to serve. Then we define several request handlers(yes, you could use regular expressions for that). And then there is a block with filters. They could be global — when there is no specific path defined — and path specific. And of course you could define some exception handlers too. The only thing is left to be done — call <em>start()</em> method. By default your application will listen on the <strong>port 9000</strong>. But you could just pass any port value you want as argument to <em>start()</em> method or define it with server.port system property(<em>-Dserver.port=8080</em>).</p> <h4 id="conclusion"><a href="#conclusion" class="header-anchor">#</a> Conclusion</h4> <p>I hope you got interested with my project. Please, try to use it in your applications and I will be really happy to see any feedback from you. If you have never used Kotlin before, it is a good moment to start!</p> <p>Do Kotlin — do the Web!</p></div> <footer><!----> <hr> <!----></footer></article> <!----></div></div> <footer class="footer" data-v-3d9deeb8><div class="footer-left-wrap" data-v-3d9deeb8><ul class="contact" data-v-3d9deeb8><li class="contact-item" data-v-3d9deeb8><a href="https://github.com/gimlet2" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-3d9deeb8><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-v-3d9deeb8><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-3d9deeb8></path></svg>
          
        </a></li><li class="contact-item" data-v-3d9deeb8><a href="https://twitter.com/gimlet2" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-3d9deeb8><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter" data-v-3d9deeb8><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z" data-v-3d9deeb8></path></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-3d9deeb8><ul class="copyright" data-v-3d9deeb8></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.35a895ae.js" defer></script><script src="/assets/js/6.5cfe2da4.js" defer></script><script src="/assets/js/3.7a9f361b.js" defer></script><script src="/assets/js/18.e20d596b.js" defer></script>
  </body>
</html>
